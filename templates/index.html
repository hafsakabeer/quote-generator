<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="box">
        <h1>Quote Manager</h1>

        <!-- Form for Add/Edit -->
        <form id="quoteForm" class="quote-form">
            <input type="hidden" id="quoteId">
            <input type="text" id="quoteText" placeholder="Enter quote text" required>
            <input type="text" id="quoteAuthor" placeholder="Enter author" required>
            <button type="submit" id="submitBtn">Add Quote</button>
        </form>

        <hr>

        <!-- List of quotes -->
        <div id="quotesList" class="quotes-list"></div>
    </div>

    <script>
        const apiUrl = '/api/quotes';

        async function loadQuotes() {
            const res = await fetch(apiUrl);
            const quotes = await res.json();
            const listDiv = document.getElementById('quotesList');
            listDiv.innerHTML = '';

            if (quotes.length === 0) {
                listDiv.innerHTML = "<p>No quotes available</p>";
                return;
            }

            quotes.forEach(q => {
                const div = document.createElement('div');
                div.className = 'quote-item';
                div.innerHTML = `
                    <p>"${q.text}" - <strong>${q.author}</strong></p>
                    <div class="btn-group">
                        <button class="edit-btn" onclick="editQuote(${q.id}, '${q.text}', '${q.author}')">Edit</button>
                        <button class="delete-btn" onclick="deleteQuote(${q.id})">Delete</button>
                    </div>
                `;
                listDiv.appendChild(div);
            });
        }

        document.getElementById('quoteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('quoteId').value;
            const text = document.getElementById('quoteText').value;
            const author = document.getElementById('quoteAuthor').value;
            const payload = { text, author };

            if (id) {
                await fetch(`${apiUrl}/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
            } else {
                await fetch(apiUrl, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
            }

            document.getElementById('quoteId').value = '';
            document.getElementById('quoteForm').reset();
            document.getElementById('submitBtn').textContent = "Add Quote";
            loadQuotes();
        });

        function editQuote(id, text, author) {
            document.getElementById('quoteId').value = id;
            document.getElementById('quoteText').value = text;
            document.getElementById('quoteAuthor').value = author;
            document.getElementById('submitBtn').textContent = "Update Quote";
        }

        async function deleteQuote(id) {
            await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
            loadQuotes();
        }

        loadQuotes();
    </script>
</body>
</html>
